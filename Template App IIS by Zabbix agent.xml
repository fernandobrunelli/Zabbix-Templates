<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.0</version>
    <groups>
        <group>
            <name>Templates/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template App IIS by Zabbix agent</template>
            <name>Template App IIS by Zabbix agent</name>
            <description>Get metrics from IIS using Zabbix agent running on Windows&#13;
&#13;
&#13;
You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/401862-discussion-thread-for-official-zabbix-template-internet-information-services&#13;
&#13;
Template tooling version used: 0.35</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>IIS</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>IIS: {$IIS.PORT} port ping</name>
                    <type>SIMPLE</type>
                    <key>net.tcp.service[{$IIS.SERVICE},,{$IIS.PORT}]</key>
                    <history>7d</history>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <valuemap>
                        <name>Service state</name>
                    </valuemap>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                    <triggers>
                        <trigger>
                            <expression>{last()}=0</expression>
                            <name>IIS: Port {$IIS.PORT} is down</name>
                            <priority>AVERAGE</priority>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>IIS: The World Wide Web Publishing Service (W3SVC) is not running</name>
                                    <expression>{Template App IIS by Zabbix agent:service_state[W3SVC].last()}&lt;&gt;0</expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>IIS: Anonymous users per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Anonymous Users/sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The number of requests from users over an anonymous connection per second. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>IIS: Bytes Received per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Bytes Received/sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <units>Bps</units>
                    <description>The average rate per minute at which data bytes are received by the service at the Application Layer. Does not include protocol headers or control bytes.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>IIS: Bytes Sent per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Bytes Sent/sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <units>Bps</units>
                    <description>The average rate per minute at which data bytes are sent by the service.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>IIS: Bytes Total per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Bytes Total/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <units>Bps</units>
                    <description>The average rate per minute of total bytes/sec transferred by the Web service (sum of bytes sent/sec and bytes received/sec).</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>IIS: Method CGI requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\CGI Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of CGI requests that are simultaneously being processed by the Web service. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Connection attempts per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Connection Attempts/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The average rate per minute that connections using the Web service are being attempted. The count is the average for all Web sites combined.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method COPY requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Copy Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests made using the COPY method. Copy requests are used for copying files and directories. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Current connections</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Current Connections&quot;]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The number of active connections.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>IIS: Method DELETE requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Delete Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the DELETE method made. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method Method GET requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Get Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests made using the GET method. GET requests are generally used for basic file retrievals or image maps, though they can be used with forms. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method HEAD requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Head Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the HEAD method made. HEAD requests generally indicate a client is querying the state of a document they already have to see if it needs to be refreshed. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method ISAPI requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\ISAPI Extension Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of ISAPI Extension requests that are simultaneously being processed by the Web service. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Locked errors per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Locked Errors/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of errors due to requests that couldn't be satisfied by the server because the requested document was locked. These are generally reported as an HTTP 423 error code to the client. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method LOCK requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Lock Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests made using the LOCK method. Lock requests are used to lock a file for one user so that only that user can modify the file. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method MKCOL requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Mkcol Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the MKCOL method made. Mkcol requests are used to create directories on the server. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method MOVE requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Move Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the MOVE method made. Move requests are used for moving files and directories. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: NonAnonymous users per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\NonAnonymous Users/sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The number of requests from users over a non-anonymous connection per second. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>IIS: Not Found errors per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Not Found Errors/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of errors due to requests that couldn't be satisfied by the server because the requested document could not be found. These are generally reported to the client with HTTP error code 404. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method OPTIONS requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Options Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the OPTIONS method made. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method Total Other requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Other Request Methods/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>Total Other Request Methods is the number of HTTP requests that are not OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, MOVE, COPY, MKCOL, PROPFIND, PROPPATCH, SEARCH, LOCK or UNLOCK methods (since service startup). Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method POST requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Post Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>Rate of HTTP requests using POST method. Generally used for forms or gateway requests. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method PROPFIND requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Propfind Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the PROPFIND method made. Propfind requests retrieve property values on files and directories. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method PROPPATCH requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Proppatch Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the PROPPATCH method made. Proppatch requests set property values on files and directories. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method PUT requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Put Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the PUT method made. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method MS-SEARCH requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Search Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the MS-SEARCH method made. Search requests are used to query the server to find resources that match a set of conditions provided by the client. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Uptime</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Service Uptime&quot;]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <units>s</units>
                    <description>Service uptime in seconds.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{last()}&lt;10m</expression>
                            <name>IIS: has been restarted (uptime &lt; 10m)</name>
                            <priority>INFO</priority>
                            <description>Uptime is less than 10 minutes</description>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>IIS: Total connection attempts</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Total Connection Attempts (all instances)&quot;]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The total number of connections to the Web or FTP service that have been attempted since service startup. The count is the total for all Web sites or FTP sites combined.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method Total requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Total Method Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of all HTTP requests received. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method TRACE requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Trace Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the TRACE method made. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Method TRACE requests per second</name>
                    <key>perf_counter_en[&quot;\Web Service(_Total)\Unlock Requests/Sec&quot;, 60]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The rate of HTTP requests using the UNLOCK method made. Unlock requests are used to remove locks from files. Average per minute.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: Files cache hits percentage</name>
                    <key>perf_counter_en[&quot;\Web Service Cache\File Cache Hits %&quot;]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The ratio of user-mode file cache hits to total cache requests (since service startup). Note: This value might be low if the Kernel URI cache hits percentage is high.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: File cache misses</name>
                    <key>perf_counter_en[&quot;\Web Service Cache\File Cache Misses&quot;]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The total number of unsuccessful lookups in the user-mode file cache since service startup.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: URIs cache hits percentage</name>
                    <key>perf_counter_en[&quot;\Web Service Cache\URI Cache Hits %&quot;]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The ratio of user-mode URI Cache Hits to total cache requests (since service startup)</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: URI cache misses</name>
                    <key>perf_counter_en[&quot;\Web Service Cache\URI Cache Misses&quot;]</key>
                    <history>7d</history>
                    <value_type>FLOAT</value_type>
                    <description>The total number of unsuccessful lookups in the user-mode URI cache since service startup.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>IIS: World Wide Web Publishing Service (W3SVC) state</name>
                    <key>service_state[W3SVC]</key>
                    <history>7d</history>
                    <description>The World Wide Web Publishing Service (W3SVC) provides web connectivity and administration of websites through the IIS snap-in. If the World Wide Web Publishing Service stops, the operating system cannot serve any form of web request. This service was dependent on &quot;Windows Process Activation Service&quot;.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <valuemap>
                        <name>Windows service state</name>
                    </valuemap>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                    <triggers>
                        <trigger>
                            <expression>{last()}&lt;&gt;0</expression>
                            <name>IIS: The World Wide Web Publishing Service (W3SVC) is not running</name>
                            <priority>HIGH</priority>
                            <description>The World Wide Web Publishing Service (W3SVC) is not in running state. IIS cannot start.</description>
                            <dependencies>
                                <dependency>
                                    <name>IIS: Windows process Activation Service (WAS) is not the running</name>
                                    <expression>{Template App IIS by Zabbix agent:service_state[WAS].last()}&lt;&gt;0</expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>IIS: Windows Process Activation Service (WAS) state</name>
                    <key>service_state[WAS]</key>
                    <history>7d</history>
                    <description>Windows Process Activation Service (WAS) is a tool for managing worker processes that contain applications that host Windows Communication Foundation (WCF) services. Worker processes handle requests that are sent to a Web Server for specific application pools. Each application pool sets boundaries for the applications it contains.</description>
                    <applications>
                        <application>
                            <name>IIS</name>
                        </application>
                    </applications>
                    <valuemap>
                        <name>Windows service state</name>
                    </valuemap>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10m</params>
                        </step>
                    </preprocessing>
                    <triggers>
                        <trigger>
                            <expression>{last()}&lt;&gt;0</expression>
                            <name>IIS: Windows process Activation Service (WAS) is not the running</name>
                            <priority>HIGH</priority>
                            <description>Windows Process Activation Service (WAS) is not in the running state. IIS cannot start.</description>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Application pools discovery</name>
                    <key>wmi.getall[root\webAdministration, select Name from ApplicationPool]</key>
                    <delay>1h</delay>
                    <filter>
                        <evaltype>AND</evaltype>
                        <conditions>
                            <condition>
                                <macro>{#APPPOOL}</macro>
                                <value>{$IIS.APPPOOL.NOT_MATCHES}</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>A</formulaid>
                            </condition>
                            <condition>
                                <macro>{#APPPOOL}</macro>
                                <value>{$IIS.APPPOOL.MATCHES}</value>
                                <formulaid>B</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <item_prototypes>
                        <item_prototype>
                            <name>IIS: AppPool {#APPPOOL} state</name>
                            <key>perf_counter_en[&quot;\APP_POOL_WAS({#APPPOOL})\Current Application Pool State&quot;]</key>
                            <history>7d</history>
                            <description>The state of the application pool.</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>{#APPPOOL}</name>
                                </application_prototype>
                            </application_prototypes>
                            <valuemap>
                                <name>Application pool state</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>10m</params>
                                </step>
                            </preprocessing>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&lt;&gt;3 and {$IIS.APPPOOL.MONITORED:&quot;{#APPPOOL}&quot;}=1</expression>
                                    <name>IIS: Application pool {#APPPOOL} is not in Running state</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>IIS: {#APPPOOL} Uptime</name>
                            <key>perf_counter_en[&quot;\APP_POOL_WAS({#APPPOOL})\Current Application Pool Uptime&quot;]</key>
                            <history>7d</history>
                            <value_type>FLOAT</value_type>
                            <units>s</units>
                            <description>The web application uptime period since the last restart.</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>{#APPPOOL}</name>
                                </application_prototype>
                            </application_prototypes>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&lt;10m</expression>
                                    <name>IIS: {#APPPOOL} has been restarted (uptime &lt; 10m)</name>
                                    <priority>INFO</priority>
                                    <description>Uptime is less than 10 minutes</description>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>IIS: AppPool {#APPPOOL} recycles</name>
                            <key>perf_counter_en[&quot;\APP_POOL_WAS({#APPPOOL})\Total Application Pool Recycles&quot;]</key>
                            <history>7d</history>
                            <description>The number of times the application pool has been recycled since Windows Process Activation Service (WAS) started.</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>{#APPPOOL}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>10m</params>
                                </step>
                            </preprocessing>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}=1 and {$IIS.APPPOOL.MONITORED:&quot;{#APPPOOL}&quot;}=1</expression>
                                    <name>IIS: Application pool {#APPPOOL} has been recycled</name>
                                    <priority>INFO</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>IIS: AppPool {#APPPOOL} current queue size</name>
                            <key>perf_counter_en[&quot;\HTTP Service Request Queues({#APPPOOL})\CurrentQueueSize&quot;]</key>
                            <delay>30s</delay>
                            <history>7d</history>
                            <description>The number of requests in the queue.</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>{#APPPOOL}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>10m</params>
                                </step>
                            </preprocessing>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{min({$IIS.QUEUE.MAX.TIME})}&gt;{$IIS.QUEUE.MAX.WARN}</expression>
                                    <name>IIS: Request queue of {#APPPOOL} is too large (over {$IIS.QUEUE.MAX.WARN})</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>IIS: Application pool {#APPPOOL} is not in Running state</name>
                                            <expression>{Template App IIS by Zabbix agent:perf_counter_en[&quot;\APP_POOL_WAS({#APPPOOL})\Current Application Pool State&quot;].last()}&lt;&gt;3 and {$IIS.APPPOOL.MONITORED:&quot;{#APPPOOL}&quot;}=1</expression>
                                        </dependency>
                                    </dependencies>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#APPPOOL}</lld_macro>
                            <path>$.Name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$IIS.APPPOOL.MATCHES}</macro>
                    <value>.+</value>
                    <description>This macro is used in application pools discovery. Can be overridden on the host or linked template level.</description>
                </macro>
                <macro>
                    <macro>{$IIS.APPPOOL.MONITORED}</macro>
                    <value>1</value>
                    <description>Monitoring status for discovered application pools. Use context to avoid trigger firing for specific application pools. &quot;1&quot; - enabled, &quot;0&quot; - disabled.</description>
                </macro>
                <macro>
                    <macro>{$IIS.APPPOOL.NOT_MATCHES}</macro>
                    <value>&lt;CHANGE_IF_NEEDED&gt;</value>
                    <description>This macro is used in application pools discovery. Can be overridden on the host or linked template level.</description>
                </macro>
                <macro>
                    <macro>{$IIS.PORT}</macro>
                    <value>80</value>
                    <description>Listening port.</description>
                </macro>
                <macro>
                    <macro>{$IIS.QUEUE.MAX.TIME}</macro>
                    <value>5m</value>
                    <description>The time during which the queue length may exceed the threshold.</description>
                </macro>
                <macro>
                    <macro>{$IIS.QUEUE.MAX.WARN}</macro>
                    <description>Maximum application pool's request queue length for trigger expression.</description>
                </macro>
                <macro>
                    <macro>{$IIS.SERVICE}</macro>
                    <value>http</value>
                    <description>The service (http/https/etc) for port check. See &quot;net.tcp.service&quot; documentation page for more information: https://www.zabbix.com/documentation/current/ru/manual/config/items/itemtypes/simple_checks</description>
                </macro>
            </macros>
        </template>
    </templates>
    <graphs>
        <graph>
            <name>IIS: Cache hits percentage</name>
            <type>STACKED</type>
            <graph_items>
                <graph_item>
                    <drawtype>GRADIENT_LINE</drawtype>
                    <color>1A7C11</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service Cache\URI Cache Hits %&quot;]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <drawtype>GRADIENT_LINE</drawtype>
                    <color>2774A4</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service Cache\File Cache Hits %&quot;]</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>IIS: Cache misses</name>
            <graph_items>
                <graph_item>
                    <color>1A7C11</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service Cache\URI Cache Misses&quot;]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>2774A4</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service Cache\File Cache Misses&quot;]</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>IIS: Requests rate</name>
            <graph_items>
                <graph_item>
                    <color>1A7C11</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Total Method Requests/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>2774A4</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Other Request Methods/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Get Requests/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>3</sortorder>
                    <color>A54F10</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Post Requests/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>4</sortorder>
                    <color>FC6EA3</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Put Requests/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>5</sortorder>
                    <color>6C59DC</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Delete Requests/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>6</sortorder>
                    <color>AC8C14</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Head Requests/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>7</sortorder>
                    <color>611F27</color>
                    <item>
                        <host>Template App IIS by Zabbix agent</host>
                        <key>perf_counter_en[&quot;\Web Service(_Total)\Trace Requests/Sec&quot;, 60]</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
    <value_maps>
        <value_map>
            <name>Application pool state</name>
            <mappings>
                <mapping>
                    <value>1</value>
                    <newvalue>Uninitialized</newvalue>
                </mapping>
                <mapping>
                    <value>2</value>
                    <newvalue>Initialized</newvalue>
                </mapping>
                <mapping>
                    <value>3</value>
                    <newvalue>Running</newvalue>
                </mapping>
                <mapping>
                    <value>4</value>
                    <newvalue>Disabling</newvalue>
                </mapping>
                <mapping>
                    <value>5</value>
                    <newvalue>Disabled</newvalue>
                </mapping>
                <mapping>
                    <value>6</value>
                    <newvalue>Shutdown Pending</newvalue>
                </mapping>
                <mapping>
                    <value>7</value>
                    <newvalue>Delete Pending</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>Service state</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>Down</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>Up</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>Windows service state</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>Running</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>Paused</newvalue>
                </mapping>
                <mapping>
                    <value>2</value>
                    <newvalue>Start pending</newvalue>
                </mapping>
                <mapping>
                    <value>3</value>
                    <newvalue>Pause pending</newvalue>
                </mapping>
                <mapping>
                    <value>4</value>
                    <newvalue>Continue pending</newvalue>
                </mapping>
                <mapping>
                    <value>5</value>
                    <newvalue>Stop pending</newvalue>
                </mapping>
                <mapping>
                    <value>6</value>
                    <newvalue>Stopped</newvalue>
                </mapping>
                <mapping>
                    <value>7</value>
                    <newvalue>Unknown</newvalue>
                </mapping>
                <mapping>
                    <value>255</value>
                    <newvalue>No such service</newvalue>
                </mapping>
            </mappings>
        </value_map>
    </value_maps>
</zabbix_export>
